name: Publish Python 🐍 distributions 📦 to PyPI
on:
    release:
        types:
            - published
jobs:
    publish:
        name: Build and publish Python 🐍 distributions 📦 to PyPI and TestPyPI
        runs-on: ubuntu-latest
        permissions:
            contents: write
            packages: write
            id-token: write 
        steps:
            - uses: actions/checkout@v4
            - name: Set up Python 3.8
              uses: actions/setup-python@v5
              with:
                  python-version: 3.8
            - name: Set Version
              id: version
              run: |
                  if [[ "${{ github.event_name }}" == "release" && "${{ github.event.action }}" == "published" ]]; then
                      echo "VERSION=${GITHUB_REF#refs/tags/}" >> $GITHUB_ENV
                  else
                      TIMESTAMP=$(date +'%Y%m%d%H%M%S')
                      echo "VERSION=0.0.dev${TIMESTAMP}" >> $GITHUB_ENV
                  fi
            - name: Build package
              run: python setup.py sdist
              env:
                  VERSION: ${{ env.VERSION }}
            - name: Publish distribution 📦 to PyPI
              uses: pypa/gh-action-pypi-publish@release/v1
